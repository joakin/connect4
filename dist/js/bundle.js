(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";module.exports=Delegate;function Delegate(root){this.listenerMap=[{},{}];if(root){this.root(root)}this.handle=Delegate.prototype.handle.bind(this)}Delegate.prototype.root=function(root){var listenerMap=this.listenerMap;var eventType;if(this.rootElement){for(eventType in listenerMap[1]){if(listenerMap[1].hasOwnProperty(eventType)){this.rootElement.removeEventListener(eventType,this.handle,true)}}for(eventType in listenerMap[0]){if(listenerMap[0].hasOwnProperty(eventType)){this.rootElement.removeEventListener(eventType,this.handle,false)}}}if(!root||!root.addEventListener){if(this.rootElement){delete this.rootElement}return this}this.rootElement=root;for(eventType in listenerMap[1]){if(listenerMap[1].hasOwnProperty(eventType)){this.rootElement.addEventListener(eventType,this.handle,true)}}for(eventType in listenerMap[0]){if(listenerMap[0].hasOwnProperty(eventType)){this.rootElement.addEventListener(eventType,this.handle,false)}}return this};Delegate.prototype.captureForType=function(eventType){return["blur","error","focus","load","resize","scroll"].indexOf(eventType)!==-1};Delegate.prototype.on=function(eventType,selector,handler,useCapture){var root,listenerMap,matcher,matcherParam;if(!eventType){throw new TypeError("Invalid event type: "+eventType)}if(typeof selector==="function"){useCapture=handler;handler=selector;selector=null}if(useCapture===undefined){useCapture=this.captureForType(eventType)}if(typeof handler!=="function"){throw new TypeError("Handler must be a type of Function")}root=this.rootElement;listenerMap=this.listenerMap[useCapture?1:0];if(!listenerMap[eventType]){if(root){root.addEventListener(eventType,this.handle,useCapture)}listenerMap[eventType]=[]}if(!selector){matcherParam=null;matcher=matchesRoot.bind(this)}else if(/^[a-z]+$/i.test(selector)){matcherParam=selector;matcher=matchesTag}else if(/^#[a-z0-9\-_]+$/i.test(selector)){matcherParam=selector.slice(1);matcher=matchesId}else{matcherParam=selector;matcher=matches}listenerMap[eventType].push({selector:selector,handler:handler,matcher:matcher,matcherParam:matcherParam});return this};Delegate.prototype.off=function(eventType,selector,handler,useCapture){var i,listener,listenerMap,listenerList,singleEventType;if(typeof selector==="function"){useCapture=handler;handler=selector;selector=null}if(useCapture===undefined){this.off(eventType,selector,handler,true);this.off(eventType,selector,handler,false);return this}listenerMap=this.listenerMap[useCapture?1:0];if(!eventType){for(singleEventType in listenerMap){if(listenerMap.hasOwnProperty(singleEventType)){this.off(singleEventType,selector,handler)}}return this}listenerList=listenerMap[eventType];if(!listenerList||!listenerList.length){return this}for(i=listenerList.length-1;i>=0;i--){listener=listenerList[i];if((!selector||selector===listener.selector)&&(!handler||handler===listener.handler)){listenerList.splice(i,1)}}if(!listenerList.length){delete listenerMap[eventType];if(this.rootElement){this.rootElement.removeEventListener(eventType,this.handle,useCapture)}}return this};Delegate.prototype.handle=function(event){var i,l,type=event.type,root,phase,listener,returned,listenerList=[],target,EVENTIGNORE="ftLabsDelegateIgnore";if(event[EVENTIGNORE]===true){return}target=event.target;if(target.nodeType===3){target=target.parentNode}root=this.rootElement;phase=event.eventPhase||(event.target!==event.currentTarget?3:2);switch(phase){case 1:listenerList=this.listenerMap[1][type];break;case 2:if(this.listenerMap[0]&&this.listenerMap[0][type])listenerList=listenerList.concat(this.listenerMap[0][type]);if(this.listenerMap[1]&&this.listenerMap[1][type])listenerList=listenerList.concat(this.listenerMap[1][type]);break;case 3:listenerList=this.listenerMap[0][type];break}l=listenerList.length;while(target&&l){for(i=0;i<l;i++){listener=listenerList[i];if(!listener){break}if(listener.matcher.call(target,listener.matcherParam,target)){returned=this.fire(event,target,listener)}if(returned===false){event[EVENTIGNORE]=true;event.preventDefault();return}}if(target===root){break}l=listenerList.length;target=target.parentElement}};Delegate.prototype.fire=function(event,target,listener){return listener.handler.call(target,event,target)};var matches=function(el){if(!el)return;var p=el.prototype;return p.matches||p.matchesSelector||p.webkitMatchesSelector||p.mozMatchesSelector||p.msMatchesSelector||p.oMatchesSelector}(Element);function matchesTag(tagName,element){return tagName.toLowerCase()===element.tagName.toLowerCase()}function matchesRoot(selector,element){if(this.rootElement===window)return element===document;return this.rootElement===element}function matchesId(id,element){return id===element.id}Delegate.prototype.destroy=function(){this.off();this.root()}},{}],2:[function(require,module,exports){"use strict";var Delegate=require("./delegate");module.exports=function(root){return new Delegate(root)};module.exports.Delegate=Delegate},{"./delegate":1}],3:[function(require,module,exports){module.exports=parse;var map={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:[0,"",""]};map.td=map.th=[3,"<table><tbody><tr>","</tr></tbody></table>"];map.option=map.optgroup=[1,'<select multiple="multiple">',"</select>"];map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,"<table>","</table>"];map.text=map.circle=map.ellipse=map.line=map.path=map.polygon=map.polyline=map.rect=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];function parse(html,doc){if("string"!=typeof html)throw new TypeError("String expected");if(!doc)doc=document;var m=/<([\w:]+)/.exec(html);if(!m)return doc.createTextNode(html);html=html.replace(/^\s+|\s+$/g,"");var tag=m[1];if(tag=="body"){var el=doc.createElement("html");el.innerHTML=html;return el.removeChild(el.lastChild)}var wrap=map[tag]||map._default;var depth=wrap[0];var prefix=wrap[1];var suffix=wrap[2];var el=doc.createElement("div");el.innerHTML=prefix+html+suffix;while(depth--)el=el.lastChild;if(el.firstChild==el.lastChild){return el.removeChild(el.firstChild)}var fragment=doc.createDocumentFragment();while(el.firstChild){fragment.appendChild(el.removeChild(el.firstChild))}return fragment}},{}],4:[function(require,module,exports){!function(name,definition){if(typeof module!="undefined")module.exports=definition();else if(typeof define=="function"&&typeof define.amd=="object")define(definition);else this[name]=definition()}("domready",function(){var fns=[],listener,doc=document,domContentLoaded="DOMContentLoaded",loaded=/^loaded|^c/.test(doc.readyState);if(!loaded)doc.addEventListener(domContentLoaded,listener=function(){doc.removeEventListener(domContentLoaded,listener);loaded=1;while(listener=fns.shift())listener()});return function(fn){loaded?fn():fns.push(fn)}})},{}],5:[function(require,module,exports){var clone=require("../utils/clone");var Board=module.exports=function(size){var cells=[];for(var i=0;i<size;i++){cells.push([]);for(var j=0;j<size;j++)cells[i].push(Board.Chips.EMPTY)}return{size:size,cells:cells}};Board.Chips={EMPTY:" ",BLUE:"O",RED:"X"};Board.get=function(row,col,b){return b.cells[row][col]};Board.set=function(row,col,val,b){var nb=clone(b);nb.cells[row][col]=val;return nb};Board.put=function(col,val,b){var nb=clone(b);for(var i=0;i<nb.size;i++){var row=nb.cells[i];if(row[col]===Board.Chips.EMPTY){row[col]=val;return nb}}throw new Error("Column",col,"is full in board",b)};Board.isFull=function(board){var i,j,row;for(i=0;i<board.size;i++)for(row=board.cells[i],j=0;j<board.size;j++)if(row[j]===Board.Chips.EMPTY)return false;return true};function shouldCheck(board){return function(idx){return idx<=board.size-4}}Board.hasFourInline=function(board){var checkIdx=shouldCheck(board);for(var rowIdx=0;rowIdx<7;rowIdx++){var row=board.cells[rowIdx];for(var colIdx=0;colIdx<7;colIdx++){var currentChip=row[colIdx];var iniDownDiag=checkIdx(rowIdx+3)&&board.cells[rowIdx+3][colIdx];var valValid=true&&currentChip!==Board.Chips.EMPTY;var downDiagValid=true&&iniDownDiag!==Board.Chips.EMPTY;var canBeHorizontal=valValid&&checkIdx(colIdx);var canBeVertical=valValid&&checkIdx(rowIdx);var canBeUpDiag=valValid&&checkIdx(rowIdx)&&checkIdx(colIdx);var canBeDownDiag=downDiagValid&&checkIdx(rowIdx)&&checkIdx(colIdx);var horizontal=canBeHorizontal;var vertical=canBeVertical;var updiag=canBeUpDiag;var downdiag=canBeDownDiag;if(canBeHorizontal||canBeVertical||canBeUpDiag||canBeDownDiag){for(var k=1;k<4;k++){horizontal=horizontal&&currentChip===row[colIdx+k];vertical=vertical&&currentChip===board.cells[rowIdx+k][colIdx];updiag=updiag&&currentChip===board.cells[rowIdx+k][colIdx+k];downdiag=downdiag&&iniDownDiag===board.cells[rowIdx+3-k][colIdx+k]}var how=null;var where=[rowIdx,colIdx];if(horizontal)how="HORIZONTAL";if(vertical)how="VERTICAL";if(updiag)how="UPDIAGONAL";if(downdiag){how="DOWNDIAGONAL";where=[rowIdx+3,colIdx]}if(how)return{how:how,where:where}}}}return null}},{"../utils/clone":13}],6:[function(require,module,exports){var Board=require("./board");var Player=require("./player");var clone=require("../utils/clone");var States=exports.States={INIT:"INIT",BLUE:"BLUE",RED:"RED",GAMEOVER:"GAMEOVER"};exports.init=function(){return{players:{blue:"",red:""},board:Board(7),state:States.INIT}};exports.start=function(player1,player2,game){if(game.state!==States.INIT)throw new Error("Can't start a game that is not new");if(!Player.valid(player1)||!Player.valid(player2))throw new Error("Some player names are not valid.",player1,player2);var started=clone(game);started.players.blue=player1;started.players.red=player2;started.state=States.BLUE;return started};exports.play=function(col,game){if(game.state!==States.BLUE&&game.state!==States.RED)throw new Error("You can only play when the game is running");var played=clone(game);played.board=Board.put(col,Board.Chips[played.state],played.board);var fourInline=Board.hasFourInline(played.board);if(fourInline){return win(fourInline,played)}if(Board.isFull(played.board)){return gameOver(played)}return switchTurn(played)};function switchTurn(game){var turn=game.state===States.BLUE?States.RED:States.BLUE;game.state=turn;return game}function gameOver(game){var over=clone(game);over.state=States.GAMEOVER;return over}function win(fourInline,game){var won=clone(game);won.winner=game.state;won.state=States.GAMEOVER;won.line=fourInline;return won}exports.print=function(g){console.log(" ",g.state,"winner:",g.winner,"line:",g.line&&g.line.how,g.line&&g.line.where.join(", "));console.log(g.board.cells.map(function(r){return[""].concat(r).concat([""]).join("|")}).reverse().join("\n"));console.log(g)};function getPlayer(state,game){return game.players[state.toLowerCase()]}exports.currentPlayer=function(game){return getPlayer(game.state,game)};exports.winner=function(game){return getPlayer(game.winner,game)};exports.looser=function(game){var w=exports.winner(game);return game.players.blue===w?game.players.red:game.players.blue}},{"../utils/clone":13,"./board":5,"./player":7}],7:[function(require,module,exports){exports.valid=function(player){return typeof player==="string"&&player!==""}},{}],8:[function(require,module,exports){var UI=require("./ui");UI.init("connect4")},{"./ui":11}],9:[function(require,module,exports){var domify=require("domify");var Connect4=require("../game");var GameOver=module.exports={screen:domify("<div class='game-over'>\n  <h2>Congratulations <span class='winner'></span></h2>\n  <h4>Maybe next time <span class='looser'></span> :(</h4>\n  <button class='restart'>Try again?</button>\n</div>\n")};GameOver.init=function(ui,restart){ui.dom.appendChild(GameOver.screen.cloneNode(true));var screen={winner:ui.dom.querySelector(".winner"),looser:ui.dom.querySelector(".looser")};screen.winner.textContent=Connect4.winner(ui.game);screen.looser.textContent=Connect4.looser(ui.game);ui.events.on("click",".restart",restart.bind(null,ui));return screen}},{"../game":6,domify:3}],10:[function(require,module,exports){var domify=require("domify");var Connect4=require("../game");var Game=module.exports={screen:domify("\n<p class='turn'>\nIt is <span></span>'s turn\n</p>\n<div class='board'>\n  <div class='cell'>\n  </div>\n</div>\n<p class='msg'></p>\n")};Game.init=function(ui,play){ui.dom.appendChild(Game.screen.cloneNode(true));var screen={cell:ui.dom.querySelector(".cell"),board:ui.dom.querySelector(".board"),name:ui.dom.querySelector(".turn>span")};Game.render(screen,ui);ui.events.on("click",".cell",function(ev,cell){var row=cell.dataset.row;var col=cell.dataset.col;play(row,col,ui)});return screen};Game.drawBoard=function(screen,board){screen.board.innerHTML="";var domBoard=board.cells.map(function(row,r){return row.map(cellToDom.bind(null,screen.cell,r))});domBoard.reverse().forEach(function(row,i){row.forEach(function(cell,j){screen.board.appendChild(cell)})})};function cellToDom(cellDom,row,cell,col){var nc=cellDom.cloneNode(true);nc.dataset.row=row;nc.dataset.col=col;nc.textContent=cell;return nc}Game.drawTurn=function(screen,ui){screen.name.textContent=Connect4.currentPlayer(ui.game)};Game.render=function(screen,ui){Game.drawTurn(screen,ui);Game.drawBoard(screen,ui.game.board)}},{"../game":6,domify:3}],11:[function(require,module,exports){var domready=require("domready");var delegate=require("dom-delegate");var Connect4=require("../game");var Initial=require("./initial");var Game=require("./game");var GameOver=require("./game-over");exports.init=function(id){domready(function(){var dom=document.getElementById(id);var ui={id:id,dom:dom,game:Connect4.init(),events:delegate(dom),views:{initial:null,game:null,gameOver:null}};ui.views.initial=Initial.init(ui,startGame)})};function startGame(blue,red,ui){try{ui.game=Connect4.start(blue,red,ui.game)}catch(e){return e.message}cleanScreen(ui);ui.views.game=Game.init(ui,userPlays)}function userPlays(row,col,ui){ui.game=Connect4.play(col,ui.game);Game.render(ui.views.game,ui);if(ui.game.state===Connect4.States.GAMEOVER)gameFinished(ui)}function gameFinished(ui){ui.views.gameOver=GameOver.init(ui,restart)}function restart(ui){cleanScreen(ui);ui.events.off();exports.init(ui.id)}function cleanScreen(ui){ui.dom.innerHTML=""}},{"../game":6,"./game":10,"./game-over":9,"./initial":12,"dom-delegate":2,domready:4}],12:[function(require,module,exports){var domify=require("domify");var Initial=module.exports={screen:domify("<div class=\"welcome\">\n  <p>Welcome to connect4</p>\n  <p>Choose the name of the players</p>\n</div>\n<div class=\"playerNames\">\n  <input type='text' placeholder='player1' />\n  <input type='text' placeholder='player2' />\n  <button>Start game</button>\n  <span class='msg'></span>\n</div>\n")};Initial.init=function(ui,done){ui.dom.appendChild(Initial.screen.cloneNode(true));var screen={inputs:ui.dom.querySelectorAll(".playerNames input"),msg:ui.dom.querySelector(".playerNames span.msg")};ui.events.on("click",".playerNames button",setPlayers.bind(null,screen,ui,done))};function setPlayers(screen,ui,done){var blue=screen.inputs[0].value;var red=screen.inputs[1].value;if(!blue||!red){screen.msg.textContent="Every player needs a name!";return}var res=done(blue,red,ui);if(typeof res==="string")screen.msg.textContent=res}},{domify:3}],13:[function(require,module,exports){module.exports=function(js){return JSON.parse(JSON.stringify(js))}},{}]},{},[8]);